summary: Test the skip condition feature

prepare: |
    if [ ! -f .spread-reuse.yaml ]; then
        touch /run/spread-reuse.yaml
        ln -s /run/spread-reuse.yaml .spread-reuse.yaml
    fi

execute: |
    # Check when the skip condition matches (the test execution fails)
    spread -reuse -resend &> task1.out lxd:ubuntu-22.04:checks/specific-reason || true
    grep 'Successful tasks: 1' task1.out
    grep 'Failed tasks: 1' task1.out
    grep 'Skipped tasks: 2' task1.out
    grep 'Skipping' task1.out
    grep 'specific-reason:T1' task1.out
    grep 'specific-reason:T4' task1.out

    spread -reuse -resend &> task2.out lxd:ubuntu-22.04:checks/skip-execute || true
    grep 'Successful tasks: 0' task2.out
    grep 'Failed tasks: 1' task2.out
    ! grep 'Skipping' task2.out

debug: |
    cat task1.out || true
    cat task2.out || true
